'use strict';

function _interopDefault (ex) { return (ex && (typeof ex === 'object') && 'default' in ex) ? ex['default'] : ex; }

var React = _interopDefault(require('react'));

class SoundVisualizer extends React.Component{constructor(a){super(a),this.state={circleRadius:SoundVisualizer.getRadiusFromProps(a),maxBarSize:SoundVisualizer.getMaxBarSize(a)},this.canvas=React.createRef(),this.spectrum=new Uint8Array(a.fftSize/2),this.audioCtx=new AudioContext,this.processSound=this.processSound.bind(this),this.draw=this.draw.bind(this);}componentDidMount(){const{fftSize:a}=this.props;this.analyser=this.audioCtx.createAnalyser(),this.analyser.fftSize=a,this.analyser.smoothingTimeConstant=.6,this.processSound(this.props.soundStream),requestAnimationFrame(this.draw);}static getDerivedStateFromProps(a){return {circleRadius:SoundVisualizer.getRadiusFromProps(a),maxBarSize:SoundVisualizer.getMaxBarSize(a)}}componentDidUpdate(){this.analyser.fftSize=this.props.fftSize,this.spectrum=new Uint8Array(this.props.fftSize/2),this.processSound(this.props.soundStream);}componentWillUnmount(){this.analyser&&0<this.analyser.numberOfInputs&&this.analyser.disconnect(),this.audioCtx&&this.audioCtx.close(),this.analyser=null,this.audioCtx=null;}static distributeAngles(a,b){var c=Math.PI;return 2*(a/b)*c+c/3}static getRadiusFromProps(a){return Math.min(a.width,a.height)*a.ratio/2}static getMaxBarSize(a){return Math.min(a.width,a.height)*(1-a.ratio)/2}processSound(a){const{width:b,height:c,fftSize:d}=this.props,{circleRadius:e}=this.state,f=d/2;this.particles=Array(f).fill({}).map((a,d)=>{const g=SoundVisualizer.distributeAngles(d,f);return {x:b/2+Math.cos(g)*e,y:c/2+Math.sin(g)*e,angle:g}});const g=this.audioCtx.createMediaStreamSource(a);g.connect(this.analyser);}draw(){const{width:a,height:b,lineWidth:c,fftSize:d}=this.props,{maxBarSize:e,circleRadius:f}=this.state;if(this.analyser&&0<this.analyser.numberOfInputs){this.analyser.getByteFrequencyData(this.spectrum);const h=d/2,i=this.canvas.current.getContext("2d");i.clearRect(0,0,a,b),i.fillStyle="#ff7f27",i.strokeStyle="#ff7f27",i.lineWidth=c||1;let j,k,l,m=0;for(var g=0;g<h;g++){m+=this.spectrum[g],j=this.spectrum[g]/256*e;const c=this.particles[g];k=a/2+Math.cos(c.angle)*(j+f),l=b/2+Math.sin(c.angle)*(j+f),i.beginPath(),i.moveTo(c.x,c.y),i.lineTo(k,l),i.stroke(),i.closePath();}m/=h,m/=256,this.drawLogo(i,m);}requestAnimationFrame(this.draw);}drawLogo(a,b){var c=Math.asin,d=Math.cos,e=Math.PI;const{width:f,height:g}=this.props,{circleRadius:h}=this.state,i=f/2,j=g/2,k=h/3;[a=>{a.moveTo(i-h/3,j+h/2),a.lineTo(i+h/3,j+h/2);},a=>{a.moveTo(i,j+h/2),a.lineTo(i,j+h/3);},a=>{a.arc(i,j,h/3,0,Math.PI);},a=>{a.arc(i,j,k,0,Math.PI),a.moveTo(i+k,j-k),a.lineTo(i+k,j),a.arc(i,j-k,k,0,Math.PI,!0),a.moveTo(i-k,j-k),a.lineTo(i-k,j);}].forEach(b=>{a.beginPath(),b(a),a.stroke(),a.closePath();});const l=Math.floor(h*b);if(!(1>l))if(l<k){const b=(k-l)/k,f=c(b),g=d(f);a.beginPath(),a.arc(i,j,k,f,e-f),a.lineTo(i+g*k,j+b*k),a.closePath(),a.fill();}else if(l<2*k){const b=l-k;a.beginPath(),a.arc(i,j,k,0,Math.PI),a.lineTo(i-k,j-b),a.lineTo(i+k,j-b),a.lineTo(i+k,j),a.closePath(),a.fill();}else{const b=(k-(l-2*k))/k,f=c(b),g=d(f);a.beginPath(),a.arc(i,j,k,0,Math.PI),a.lineTo(i-k,j-k),a.arc(i,j-k,k,Math.PI,e+f),a.lineTo(i+g*k,j-k-b*k),a.arc(i,j-k,k,2*e-f,2*e),a.lineTo(i+k,j),a.closePath(),a.fill();}}render(){return React.createElement("canvas",{width:this.props.width,height:this.props.height,ref:this.canvas})}}

module.exports = SoundVisualizer;
//# sourceMappingURL=index.min.js.map
