'use strict';

function _interopDefault (ex) { return (ex && (typeof ex === 'object') && 'default' in ex) ? ex['default'] : ex; }

var React = _interopDefault(require('react'));

const CANVAS_WIDTH=600,CANVAS_HEIGHT=125,RADIUS=.4*CANVAS_HEIGHT,MAX_BAR_SIZE=.1*CANVAS_HEIGHT;class SoundVisualizer extends React.Component{constructor(a){super(a),this.state={logoLoaded:!1},this.canvas=React.createRef(),this.spectrum=new Uint8Array(a.fftSize/2),this.audioCtx=new AudioContext,this.processSound=this.processSound.bind(this),this.draw=this.draw.bind(this);}componentDidMount(){const a=this.props.fftSize;this.analyser=this.audioCtx.createAnalyser(),this.analyser.fftSize=a,this.analyser.smoothingTimeConstant=.6,this.processSound(this.props.soundStream),requestAnimationFrame(this.draw);}distributeAngles(a,b){var c=Math.PI;return 2*(a/b)*c+c/3}drawLogo(a,b){var c=Math.cos,d=Math.asin,e=Math.PI;const f=300,g=CANVAS_HEIGHT/2,h=RADIUS/4;[a=>{a.moveTo(f-RADIUS/3,g+RADIUS/2),a.lineTo(f+RADIUS/3,g+RADIUS/2);},a=>{a.moveTo(f,g+RADIUS/2),a.lineTo(f,g+RADIUS/3);},a=>{a.arc(f,g,RADIUS/3,0,Math.PI);},a=>{a.arc(f,g,h,0,Math.PI),a.moveTo(f+h,g-h),a.lineTo(f+h,g),a.arc(f,g-h,h,0,Math.PI,!0),a.moveTo(f-h,g-h),a.lineTo(f-h,g);}].forEach(b=>{a.beginPath(),b(a),a.stroke(),a.closePath();});const i=Math.floor(3*h*b);if(!(1>i))if(i<h){const b=(h-i)/h,j=d(b),k=c(j);a.beginPath(),a.arc(f,g,h,j,e-j),a.lineTo(f+k*h,g+b*h),a.closePath(),a.fill();}else if(i<2*h){const b=i-h;a.beginPath(),a.arc(f,g,h,0,Math.PI),a.lineTo(f-h,g-b),a.lineTo(f+h,g-b),a.lineTo(f+h,g),a.closePath(),a.fill();}else{const b=(h-(i-2*h))/h,j=d(b),k=c(j);a.beginPath(),a.arc(f,g,h,0,Math.PI),a.lineTo(f-h,g-h),a.arc(f,g-h,h,Math.PI,e+j),a.lineTo(f+k*h,g-h-b*h),a.arc(f,g-h,h,2*e-j,2*e),a.lineTo(f+h,g),a.closePath(),a.fill();}}draw(){if(this.analyser&&0<this.analyser.numberOfInputs){this.analyser.getByteFrequencyData(this.spectrum);const b=this.analyser.frequencyBinCount,c=this.canvas.current.getContext("2d");c.clearRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT),c.fillStyle="#ff7f27",c.strokeStyle="#ff7f27",c.lineWidth=1.25;let d,e,f,g=0;for(var a=0;a<b;a++){g+=this.spectrum[a]*this.spectrum[a],d=this.spectrum[a]/256*MAX_BAR_SIZE;const b=this.particles[a];e=300+Math.cos(b.angle)*(d+RADIUS),f=CANVAS_HEIGHT/2+Math.sin(b.angle)*(d+RADIUS),c.beginPath(),c.moveTo(b.x,b.y),c.lineTo(e,f),c.stroke(),c.closePath();}g/=b,g=Math.sqrt(g),g/=256,this.drawLogo(c,g);}requestAnimationFrame(this.draw);}componentWillReceiveProps(a){a.forceUpdater&&a.forceUpdater!==this.props.forceUpdater&&this.processSound(a.soundStream);}componentWillUnmount(){this.analyser&&0<this.analyser.numberOfInputs&&this.analyser.disconnect(),this.audioCtx&&this.audioCtx.close(),this.analyser=null,this.audioCtx=null;}processSound(a){const b=this.analyser.frequencyBinCount;this.particles=Array(b).fill({}).map((a,c)=>{const d=this.distributeAngles(c,b/2);return {x:300+Math.cos(d)*RADIUS,y:CANVAS_HEIGHT/2+Math.sin(d)*RADIUS,angle:d}});const c=this.audioCtx.createMediaStreamSource(a);c.connect(this.analyser);}render(){return React.createElement("canvas",{width:CANVAS_WIDTH,height:CANVAS_HEIGHT,ref:this.canvas})}}

module.exports = SoundVisualizer;
//# sourceMappingURL=index.min.js.map
